name: Exit code 0 fail

type: frequency

index: platform-logs-*

filter:
- query:
    query_string:
      query: "platform.channel: spark_client_success AND content.return_code: 1"

num_events: 1
timeframe: 
  minutes: 10
doc_type: _doc

realert:
 minutes: 15

alert_text_type: alert_text_only
alert_text: "\n At least one exit 1 code have been received during punchlines execution in spark client mode"

alert:
- command
- post

command: 
  - "/bin/echo"
  - "alert: At least one exit 1 code have been received during punchlines execution in spark client mode"

post:
http_post_url: {{ livedemo_api_url }}
http_post_all_values: True
http_post_static_payload:
  rule_name: Exit code 0 fail
  rule_description: At least one exit 1 code have been received during punchlines execution in spark client mode
  user: {{ user }}
  sysname: {{ sysname }}
  release: {{ release }}
  machine: {{ machine }}
  vagrant_config: {{ vagrant_config }}
  vagrant_os: {{ vagrant_os }}
  branch: {{ branch }}
  commit: {{ commit }}
