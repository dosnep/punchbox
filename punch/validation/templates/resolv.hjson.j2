{ 

   {% if punch.elasticsearch is defined %}
   // All ES input/output nodes (Storm nodes)
   elasticsearch_nodes:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.dag[?(@.type=='elasticsearch_input' || @.type=='elasticsearch_output')].settings
      additional_values:{ 
         http_hosts:[ 
            { 
               host:{{ punch.elasticsearch.cluster_production_transport_address }}
               port:9200
            }
         ]
      }
   }

   // All ES spark nodes 
   elastic_nodes:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.dag[?(@.type=='elastic_batch_input' || @.type=='elastic_batch_output' || @.type=='elastic_stream_output' || @.type=='elastic_input' || @.type=='elastic_query_stats' || @.type=='python_elastic_input' || @.type=='python_elastic_output')].settings
      additional_values:{ 
         nodes:[ 
            {{ punch.elasticsearch.cluster_production_transport_address }}
         ]
      }
   }
   {% endif %}


   {% if punch.kafka is defined %}
   // All Kafka input/output nodes (Storm nodes)
   kafka_input:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.dag[?(@.type=='kafka_input' || @.type=='kafka_output')].settings
      additional_values:{ 
         bootstrap.servers:{{ punch.kafka.brokers[0] }}
         metric_cluster_id:local
      }
   }
   {% endif %}


   {% if punch.elasticsearch is defined %}
   // All ES reporters
   es_reporter:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.metrics.reporters[?(@.type=='elasticsearch')]
      additional_values:{ 
         http_hosts:[ 
            { 
               host:{{ punch.elasticsearch.cluster_production_transport_address }}
               port:9200
            }
         ]
      }
   }
   {% endif %}

   {% if punch.kafka is defined %}
   // All Kafka reporters
   kafka_reporter:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.metrics.reporters[?(@.type=='kafka')]
      additional_values:{ 
         bootstrap.servers:{{ punch.kafka.brokers[0] }}
      }
   }
   {% endif %}

   {% if punch.elasticsearch is defined %}
   // All plan persistence
   persistence_plan_resolver:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.plan_settings.persistence[?(@.type=='elasticsearch')]
      additional_values:{ 
         nodes:[ 
           	{
               host:{{ punch.elasticsearch.cluster_production_transport_address }}
               port:9200
        	   } 
         ]
      }
   }
   // Archive houeskeeping
   archive_housekeeping:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.archiving_pools[*]
      additional_values:{ 
         es_cluster_id: es_search
      }
   }
   // Channel monitoring 
   channel_monitoring:{ 
      selection:{ 
         tenant:*
         channel: admin
         runtime:*
      }
      match: .elasticsearch
      additional_values:{ 
         es_cluster_id: es_search
      }
   }
   // Channel monitoring reporters 
   channel_monitoring_reporters:{ 
      selection:{ 
         tenant:*
         channel: admin
         runtime:*
      }
      match:$.reporters[?(@.type=='elasticsearch')]
      additional_values:{ 
       cluster_name: es_search
      }
   }
    // ES Housekeeping 
   es_housekeeping:{ 
      selection:{ 
         tenant:*
         channel: admin
         runtime:*
      }
      match:$.clusters_settings[*]
      additional_values:{ 
       cluster_id: es_search
      }
   }
   // Elastalert
   elastalert:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.[?(@.writeback_index=='elastalert')]
      additional_values:{ 
         es_host: {{ punch.elasticsearch.cluster_production_transport_address }}
         es_port: 9200
      }
   }
   // Elastalert slack fail
   elastalert_slack_fail:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.[?(@.name=~ /.*fail.*/i)]
      additional_values:{ 
         alert: slack
         slack_webhook_url: "{{ webhook }}"
         slack_proxy: "{{ proxy }}"
         slack_emoji_override: ":punchlogo2:"
         slack_msg_color: "danger"
         slack_title: "6.0 validation from {{ hostname }} on {{os}}"
      }
   }
     // Elastalert slack fail
   elastalert_slack_success:{ 
      selection:{ 
         tenant:*
         channel:*
         runtime:*
      }
      match:$.[?(@.name=~ /.*success.*/i)]
      additional_values:{ 
        alert: slack
        slack_webhook_url: "{{ webhook }}"
        slack_proxy: "{{ proxy }}"
        slack_emoji_override: ":punchlogo2:"
        slack_msg_color: "good"
        slack_title: "6.0 validation from {{ hostname }} on {{os}}"
      }
   }
   {% endif %}
}